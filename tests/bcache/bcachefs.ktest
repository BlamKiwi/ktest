#!/bin/bash

require-lib bcache-test-libs.sh
require-make ../../ltp-fsx/Makefile ltp-fsx

config-cache 2G
config-bucket-size 64k
config-block-size 2k
config-mem 512M

config-timeout $(stress_timeout)

main()
{
    FS=bcachefs

    setup_tracing 64 'bcache:*'

    setup_bcache

    test_antagonist

    setup_fs
    test_bonnie
    test_dbench
    #test_fsx
    stop_fs

    stop_bcache
}
