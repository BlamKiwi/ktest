#!/bin/bash

require-lib ../test-libs.sh
require-bin make-bcache
require-kernel-config MD,BCACHE

config-scratch-devs 512M,2G,2G
config-mem 256M

main()
{
    CACHE=vda
    BDEV="vdb vdc"
    DEV="bcache0 bcache1"

    prep_bcache_devices || exit

    cache_set_settings
    cached_dev_settings

    prep_mounts || exit

    test_sysfs

    test_shrink &
    test_fault &
    test_stress &

    sleep 100
    echo "TEST SUCCESSFUL"
}
