#!/bin/bash

require-lib bcache-test-libs.sh

config-cache 512M
config-tier 2G
config-bucket-size 64k
config-block-size 4k
config-volume 1400M

config-timeout $(stress_timeout)

main()
{
    setup_tracing 'bcache:*'

    setup_bcache
    test_antagonist

    CSETUUID=`bcacheadm list-cachesets`
    echo $CSETUUID
    bcacheadm stats --all -u $CSETUUID
    bcacheadm stats --all -u $CSETUUID -c 0
    bcacheadm stats --list -u $CSETUUID --total-stats
    bcache_dev_query /dev/sdb /dev/sdc
    bcache_status /dev/sdb /dev/sdc

    stop_bcache
}
