#!/bin/bash

require-lib bcache-test-libs.sh
require-kernel-config XFS_FS

config-cache 512M
config-backing 2G,2G
config-bucket-size 64k
config-block-size 4k
config-writeback
config-mem 512M

config-timeout $(stress_timeout)

main()
{
    FS=xfs

    setup_tracing 64 'bcache:*'

    setup_bcache
    test_antagonist
    test_stress
    stop_bcache
}
