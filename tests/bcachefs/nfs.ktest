#!/bin/bash

require-lib ../test-libs.sh

require-kernel-config BCACHE,BCACHE_DEBUG
require-file mkfs.bcache

require-kernel-config NFSD
require-kernel-config NFSD_V3
require-kernel-config NFSD_V4

config-scratch-devs 2G
config-timeout 60

main()
{
    #apt update
    #apt install -y nfs-kernel-server

    mkdir /export1 /export2

    mkfs.bcache /dev/sdb
    mount /dev/sdb /export2

    echo "/export1  *(ro,insecure,all_squash,no_subtree_check)" >> /etc/exports
    echo "/export2  *(ro,insecure,all_squash,no_subtree_check)" >> /etc/exports
    exportfs -a
}
